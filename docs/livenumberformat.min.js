export default class LiveNumberFormat{constructor(e,t={}){this.input=e,this.undoStack=[],this.redoStack=[],this.debounceTimer=null,this.debounceTime=t.debounceTime||300,this.allowNegative=void 0===t.allowNegative||t.allowNegative,this.decimalMark=void 0!==t.decimalMark?t.decimalMark:".",this.formatStyle=void 0!==t.formatStyle?t.formatStyle:"thousand",this.delimiter=void 0!==t.delimiter?t.delimiter:",",this.decimalScale=void 0!==t.decimalScale?t.decimalScale:1/0,this.integerScale=void 0!==t.integerScale?t.integerScale:1/0,this.stripLeadingZeroes=void 0!==t.stripLeadingZeroes&&t.stripLeadingZeroes,this.allowDecimalReplacement=void 0!==t.allowDecimalReplacement&&t.allowDecimalReplacement,this.maxUndoStackSize=t.maxUndoStackSize||500,this.init(),this.input.value&&(this.handleInput(),this.setCursorPosition(this.input.value.length))}init(){this.input.addEventListener("input",this.handleInput.bind(this)),this.input.addEventListener("keydown",this.handleKeydown.bind(this))}format(e){let t,i,s,a="";switch(e=e.replace(/[A-Za-z]/g,"").replace(this.decimalMark,"D").replace(/[^\dD-]/g,"").replace(/^\-/,"M").replace(/\-/g,"").replace("M",this.allowNegative?"-":"").replace("D",this.decimalMark),i="-"===(e=this.stripLeadingZeroes?e.replace(/^(-)?0+(?=\d)/,"$1"):e).slice(0,1)?"-":"",t=this.getParts(e,!0,!0),s=t.partInteger,"-"==i&&(s=t.partInteger.slice(1)),e.includes(this.decimalMark)&&(a=this.decimalMark+t.partDecimal),this.formatStyle){case"thousandLakhCrore":s=s.replace(/(\d)(?=(\d\d)+\d$)/g,"$1"+this.delimiter);break;case"thousand":s=s.replace(/(\d)(?=(\d{3})+$)/g,"$1"+this.delimiter);break;case"tenThousand":s=s.replace(/(\d)(?=(\d{4})+$)/g,"$1"+this.delimiter)}return i+s.toString()+(0<this.decimalScale?a.toString():"")}handleInput(e){clearTimeout(this.debounceTimer);let t=this.input.value,i=this.input.selectionEnd,s;var a;!this.stripLeadingZeroes&&t.match(new RegExp(`^[${this.delimiter}0]*$`))||(s=this.format(this.input.value),this.debounceTimer=setTimeout(()=>{this.pushToUndoStack({val:s,cpos:i})},this.debounceTime),a=this.getNextCursorPosition(i,t,s,this.delimiter),this.input.value=s,this.setCursorPosition(a))}setCursorPosition(e){this.input.setSelectionRange(e=e<0?0:e,e)}getNextCursorPosition(e,t,i,s){return t.length===e?i.length:e+this.getPositionOffset(e,t,i,s)}getDelimiterRegex(){return new RegExp(this.delimiter,"g")}getParts(e,t=!1,i=!1){e=e.split(this.decimalMark);let s=e[0],a="";return 1<e.length&&(a=e[1]),t&&(s=s.replace(this.getDelimiterRegex(),""),a=a.replace(this.getDelimiterRegex(),"")),i&&(s=s.slice(0,this.integerScale),a=a.slice(0,this.decimalScale)),{partInteger:s,partDecimal:a}}getPositionOffset(e,t,i,s){var a=new RegExp(s,"g"),r=t.slice(e),l=i.slice(e),t=t.slice(0,e).replace(a,""),i=i.slice(0,e).replace(a,"");return i.startsWith("-")&&t.match(/[^0-9\.]/g)||t.match(/[^0-9\.]/g)||this.stripLeadingZeroes&&"0"===t||r!=l&&r.startsWith(s)?-1:Math.sign(t.length-i.length)}handleKeydown(e){var t,i;"ArrowLeft"!==e.key||e.shiftKey?"ArrowRight"!==e.key||e.shiftKey?!e.ctrlKey||"z"!==e.key&&"Z"!==e.key?!e.ctrlKey||"y"!==e.key&&"Y"!==e.key?"Delete"===e.key?this.input.value[this.input.selectionStart]===this.delimiter&&(e.preventDefault(),this.setCursorPosition(this.input.selectionStart+1)):(!1===this.allowDecimalReplacement&&this.input.value.includes(this.decimalMark)&&e.key===this.decimalMark&&e.preventDefault(),this.input.selectionStart===this.input.selectionEnd&&["0","1","2","3","4","5","6","7","8","9"].includes(e.key)&&(t=this.getParts(this.input.value,!0),i=this.input.value.split(this.delimiter).length-1,(i=this.input.selectionStart-i)<=t.partInteger.length&&t.partInteger.length>=this.integerScale&&e.preventDefault(),i>t.partInteger.length)&&t.partDecimal.length>=this.decimalScale&&e.preventDefault()):this.performRedo(e):this.performUndo(e):this.handleRightArrow(e):this.handleLeftArrow(e)}handleLeftArrow(e){var t=this.input.selectionStart;t-2<0||this.input.value[t-2]===this.delimiter&&(e.preventDefault(),this.setCursorPosition(t-2))}handleRightArrow(e){var t=this.input.selectionStart;this.input.value[t]===this.delimiter&&(e.preventDefault(),this.setCursorPosition(t+2))}pushToUndoStack(e){this.undoStack.length<=this.maxUndoStackSize&&(this.undoStack.push(e),this.redoStack=[])}performUndo(e){e.preventDefault(),1<this.undoStack.length?(e=this.undoStack.pop(),this.redoStack.push(e),e=this.undoStack[this.undoStack.length-1],this.input.value=e.val,this.setCursorPosition(e.cpos)):1===this.undoStack.length&&(this.redoStack.push(this.undoStack.pop()),this.input.value="")}performRedo(e){e.preventDefault(),0<this.redoStack.length&&(e=this.redoStack.pop(),this.undoStack.push(e),this.input.value=e.val,this.setCursorPosition(e.cpos))}getRawValue(){return this.input.value}getFloatValue(){let e=this.getRawValue();return e=e&&e.match(/[0-9.-]+/g).join(""),!0===isNaN(parseFloat(e))?0:parseFloat(e)}}